% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/parallel_average_quarter_from_index.R
\name{parallel_average_quarter_from_index}
\alias{parallel_average_quarter_from_index}
\title{Average of 3-consecutive columns (quarter) given per-row starting indices}
\usage{
parallel_average_quarter_from_index(idx, mat, wrap = FALSE)
}
\arguments{
\item{idx}{Integer/numeric vector (length \code{nrow(mat)}), 1-based starting
column index per row; \code{NA} allowed.}

\item{mat}{Numeric matrix (rows = cells, columns = months).}

\item{wrap}{Logical; if \code{TRUE}, allow wrap-around windows by internally
extending \code{mat} with its first two columns.}
}
\value{
A numeric vector of length \code{nrow(mat)} with the average of the
3-month window per row. Row names are preserved from \code{mat} if present.
}
\description{
Computes, for each row, the average of a 3-consecutive-column window
(a "quarter") starting at the provided index. Uses a fast C++ routine
\code{rcpp_average_get_quarter()} that sums with \code{NA}-skipping and
divides by the count of non-\code{NA} values among the 3 elements.
}
\details{
\itemize{
\item The input \code{idx} is a \strong{1-based} starting index per row (typical in R).
\item If \code{wrap = FALSE} (default), valid indices are in
\code{1..(ncol(mat) - 2)} and windows are \code{[j, j+1, j+2]} entirely
within the matrix.
\item If \code{wrap = TRUE}, the wrapper virtually extends \code{mat} by
\code{cbind(mat, mat[,1:2])}, so starts in \code{1..ncol(mat)} are valid
and windows can wrap (e.g., Dec–Jan–Feb).
}
}
\section{NA handling}{

The underlying C++ sums with an \emph{NA-skipping} reducer and divides by the
number of non-\code{NA} elements among the three; if all three are \code{NA},
the C++ divides by zero and returns a non-finite value. This wrapper converts
any non-finite result to \code{NA_real_}.
}

\examples{
# Example: each row is 1:12, 13:24, 25:36
m1 <- matrix(1:(12*3), nrow = 3, byrow = TRUE,
             dimnames = list(paste0("cell", 1:3), paste0("m", 1:12)))
# Start at month 10 for all rows (window: 10,11,12) -> average of (10,11,12), (22,23,24), (34,35,36)
idx <- rep(10L, nrow(m1))
avg <- parallel_average_quarter_from_index(idx, m1, wrap = FALSE)
avg

# With wrap-around: start at 12 (window: 12, 1, 2)
idx2 <- c(12L, 12L, 12L)
avg_wrap <- parallel_average_quarter_from_index(idx2, m1, wrap = TRUE)
avg_wrap

}
